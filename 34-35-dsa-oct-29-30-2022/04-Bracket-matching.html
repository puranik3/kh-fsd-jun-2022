<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Matching brackets</title>
        <style>
            .editor {
                width: 100%;
                resize: none;
                font-size: 1.5em;
            }
        </style>
    </head>
    <body>
        <textarea id="editor" class="editor" rows="20"></textarea>
        You selected <span id="sel"></span>

        <script>
            const editor = document.getElementById("editor");

            function getSelectionText() {
                var text = "";
                var activeEl = document.activeElement;
                var activeElTagName = activeEl
                    ? activeEl.tagName.toLowerCase()
                    : null;
                if (
                    activeElTagName == "textarea" ||
                    (activeElTagName == "input" &&
                        /^(?:text|search|password|tel|url)$/i.test(
                            activeEl.type
                        ) &&
                        typeof activeEl.selectionStart == "number")
                ) {
                    text = activeEl.value.slice(
                        activeEl.selectionStart,
                        activeEl.selectionEnd
                    );
                } else if (window.getSelection) {
                    text = window.getSelection().toString();
                }
                return {
                    text,
                    start: activeEl.selectionStart,
                    end: activeEl.selectionEnd
                };
            }

            document.onmouseup = document.onkeyup = document.onselectionchange = function () {
                const { text, start, end } = getSelectionText();
                document.getElementById( "sel" ).textContent = `${text} ${start} ${end}`;
            };
        </script>
    </body>
</html>
